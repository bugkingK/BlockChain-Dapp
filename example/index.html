

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <link rel="stylesheet" type="text/css" href="main.css">

    <script src="./node_modules/web3/dist/web3.min.js"></script>

</head>
<body>
    <div class="container">

        <h1>Coursetro Instructor</h1>

        <h2 id="instructor"></h2>

        <img id="loader" src="https://loading.io/spinners/double-ring/lg.double-ring-spinner.gif">

        <label for="name" class="col-lg-2 control-label">Instructor Name</label>
        <input id="name" type="text">

        <label for="name" class="col-lg-2 control-label">Instructor Age</label>
        <input id="age" type="text">

        <button id="button">Update Instructor</button>


    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>

    <script>
       if (typeof web3 !== 'undefined') {
            // 현재 사용가능한 Web3 열기, 예를 들면 크롬 metamask
            web3 = new Web3(web3.currentProvider);
        } else {
            //없다면 서버의 Web3 연결하기.
            //자신의 Web3가 로컬에 있다면 http://localhost:8545로 변경하면 됩니다.
            web3 = new Web3(new Web3.providers.HttpProvider("http://bug.lasel.kr:8545"));
        }
        //eth의 기본 지갑은 0번째 지갑입니다.
        web3.eth.defaultAccount = web3.eth.accounts[0];
        // contract로 abi를 정의해 줍니다. 해당 abi는 sol파일을 컴파일 했을 때 추출됩니다.
        var CoursetroContract = web3.eth.contract([{"constant": false,"inputs": [{"name": "_fName","type": "string"},{"name": "_age","type": "uint256"}],"name": "setInstructor","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": true,"inputs": [],"name": "getInstructor","outputs": [{"name": "","type": "string"},{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"anonymous": false,"inputs": [{"indexed": false,"name": "name","type": "string"},{"indexed": false,"name": "age","type": "uint256"}],"name": "Instructor","type": "event"}]);
        
        // eth의 컨트렉트 주소를 작성해줍니다. 블록체인에 많은 스마트 컨트렉트들 중에 자신의 컨트렉트를 찾기 위함입니다.
        // 여기까지 설정이 완료된다면 블록체인과 연결된 것입니다. 따라서 solidity파일에 작성한 함수와 변수를 사용할 수 있습니다.
        var Coursetro = CoursetroContract.at('0xf02018655f54b90fd876486c1d8c350b2c85812b');
        console.log(Coursetro);

        var instructorEvent = Coursetro.Instructor();

        // 블록이 변경됨에 따라 화면의 내용이 변경됩니다.
        instructorEvent.watch(function(error, result) {
            if (!error) {
                $("#loader").hide();
                $("#instructor").html(result.args.name + ' (' + result.args.age + ' years old)');
            } else {
                $("#loader").hide();
                console.log(error);
            }
        });

        // button을 클릭했을 때 name과 age의 값을 블록체인에 전송합니다.
        $("#button").click(function() {
            Coursetro.setInstructor($("#name").val(), $("#age").val());
            $("#loader").show();
            var json = new Object();
            json.name = $("#name").val();
            json.age = $("#age").val();
            console.log(JSON.stringify(json));
        });
    </script>

</body>
</html>
